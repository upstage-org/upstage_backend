services:
  upstage:
    image: registry.access.redhat.com/ubi9/python-312:latest
    container_name: upstage_container
    ports:
      - "3000:3000"
    volumes:
      - /app_code/src:/usr/app
      - /app_code/uploads:/usr/app/uploads
      - /app_code/demo:/usr/app/dashboard/demo

    command: >
      /bin/bash -c "
      cd /usr/app &&
      pip install --upgrade pip &&
      pip install -r requirements.txt &&
      chmod +x ./startup.sh &&
      ./startup.sh"
    networks:
      - upstage-network

  upstage_event_archive:
    image: registry.access.redhat.com/ubi9/python-312:latest
    container_name: upstage_event_archive_container
    ports:
      - "83:80"
      - "446:443"
    volumes:
      - /app_code/src:/usr/app

    command: >
      /bin/bash -c "
      cd /usr/app &&
      pip install --upgrade pip &&
      pip install -r requirements.txt &&
      python3 -m scripts.run_event_archive"
    networks:
      - upstage-network    

  upstage_stats:
    image: registry.access.redhat.com/ubi9/python-312:latest
    container_name: upstage_stats_container
    ports:
      - "84:80"
      - "447:443"
    volumes:
      - /app_code/src:/usr/app
    command: >
      /bin/bash -c "
      cd /usr/app &&
      pip install --upgrade pip &&
      pip install -r requirements.txt &&
      python3 -m scripts.run_upstage_stats"
    networks:
      - upstage-network   

networks:
  service_containers_upstage-network:
volumes:
  /app_code/src:
  /app_code/uploads:
  /app_code/demo:
